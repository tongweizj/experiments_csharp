### **期末考试项目开发计划（文件级）**

#### **1. 开发路线图**
```mermaid
graph LR
    A[数据层] --> B[核心VM]
    B --> C[主界面]
    C --> D[功能模块]
    D --> E[联调测试]

    style A fill:#f9f,stroke:#333
    style B fill:#bbf,stroke:#333
```
#### 创建新项目mvvw架构，打好

1. 新建wpf项目
   把
```
- Data
  --- DataProvider.cs
- Models

- ViewModel

- Views

```

2. 新建 Class library project
#### **2. 文件级开发顺序**


**阶段0：数据层的Class library project（30分钟）**

Class library project
详细看这个文档
[[2.NuGet package管理database.md]]
1. 创建Class library project 
1. 使用 EF Core to create data model classes
2. 主项目的引用 

注意，
不要新增数据库，就在原来的shop基础上做。
减少创建新数据库造成的时间浪费



**阶段1：数据层奠基（30分钟）**


看清楚需求文档，确定，需要从数据库取哪些数据？

| 文件 | 技术要点 | 依赖关系 |
|------|----------|----------|
| `Models/DataProvider.cs` | 实现基础CRUD异步方法 | 依赖DbContext |
| `ViewModels/*.cs` | 保持与实体模型属性一致 | 需对应实体类 |

详细看文档
- `3.保持与实体模型属性一致`
- `4.LINQ`

**阶段2：核心ViewModel（60分钟）**
| 文件 | 技术要点 | 依赖关系 |
|------|----------|----------|
| `ViewModels/ViewModelBase.cs` | 封装RaisePropertyChanged | 被所有VM继承 |
| `ViewModels/MainWindowViewModel.cs` | 实现INotifyPropertyChanged | 依赖DataProvider |

- `5.MainWindowViewModel开发指南.md`

**阶段3：主界面搭建（30分钟）**

| 文件 | 技术要点 | 依赖关系 |
|------|----------|----------|
| `Views/MainWindow.xaml` | 设置正确的DataContext | 依赖MainWindowVM |

1. 控件
2. 空间摆放合适位置


**阶段4：功能模块开发（90分钟）**

| 文件 | 技术要点 | 依赖关系 |
|------|----------|----------|
| `Views/DataGridTab.xaml` | ItemsSource绑定正确路径 | 依赖FilteredItems集合 |
| `Views/ProductTab.xaml` | 实现TwoWay绑定 | 需要命令绑定 |
| `ViewModels/AddNewItemViewModel.cs` | 验证逻辑前置 | 依赖Product/Basket数据 |

3. 数据绑定
4. 控件操作

**阶段5：增强功能（可选）**
| 文件 | 技术要点 | 依赖关系 |
|------|----------|----------|
| `Converters/*.cs` | 实现IValueConverter | 需在XAML中引用 |
| `Behaviors/*.cs` | 封装交互逻辑 | 依赖Blend SDK |

#### **3. 关键文件技术备忘录**

**DataProvider.cs**
```markdown
# 注意事项
1. 所有方法必须为async
2. 每个方法使用独立using块
3. 禁止缓存DbContext实例
```

**MainWindowViewModel.cs**
```markdown
# 关键检查点
- 集合属性必须用ObservableCollection
- 异步方法需处理OperationCanceledException
- SelectedItem变更需触发筛选
```

**DataGridTab.xaml**
```markdown
# 绑定规范
1. ItemsSource指向FilteredItems
2. 列绑定路径与ViewModel属性名一致
3. 启用VirtualizingStackPanel
```

**ProductTab.xaml.cs**
```markdown
# 事件处理原则
1. 事件处理器不超过3行代码
2. 立即转发到ViewModel处理
3. 禁止在代码后台操作UI元素
```

#### **4. 应急调整方案**

**当时间不足时**：
1. 优先保证以下文件完整：
   - `MainWindow.xaml`
   - `MainWindowViewModel.cs`
   - `DataProvider.cs`

2. 可临时简化：
   - 将`DataGridTab`和`ProductTab`合并到主窗口
   - 使用静态数据代替数据库访问

#### **5. 验证流程**

**基础检查清单**：
1. [ ] `App.xaml`启动项正确
2. [ ] 所有ViewModel继承`ViewModelBase`
3. [ ] 所有XAML文件已设置`DataContext`
4. [ ] 数据绑定模式为`OneWay`/`TwoWay`

**快速测试脚本**：
```powershell
# 在Package Manager Console运行
Test-ProjectIntegrity -CheckLevel Basic
```

该计划通过严格的文件执行顺序和技术要点控制，确保在考试时间内（通常2-3小时）完成可运行的核心功能，所有技术风险点都已通过备忘录显式标注。